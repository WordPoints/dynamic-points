!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=wp.wordpoints.hooks.controller.Extension,e=wp.wordpoints.hooks.Args,f=wp.wordpoints.hooks.view.DynamicPoints,g=d.extend({defaults:{slug:"dynamic_points"},isPointsReactor:function(a){return"points"===a||"points_legacy"===a},initReaction:function(a){this.isPointsReactor(a.model.get("reactor"))&&this.listenTo(a,"render:fields",this.render)},getArgHierarchies:function(a){return e.getHierarchiesMatching({event:a,end:function(a){return"attr"===a.get("_type")&&("integer"===a.get("data_type")||"decimal_number"===a.get("data_type"))}})},render:function(a,b,c){var d=this.getArgHierarchies(c.model.get("event"));if(0!==d.length){var e=new f({model:this,reaction:c,hierarchies:d});c.$settings.append(e.render().$el)}},validateReaction:function(a,b){b.dynamic_points&&(0===b.points?delete b.dynamic_points:b.dynamic_points.arg&&"string"==typeof b.dynamic_points.arg&&(b.dynamic_points.arg=b.dynamic_points.arg.split(",")))}});b.exports=g},{}],2:[function(a,b,c){var d=wp.wordpoints.hooks;d.view.DynamicPoints=a("./views/extension.js"),d.extension.DynamicPoints=a("./controllers/extension.js"),d.Extensions.add(new d.extension.DynamicPoints)},{"./controllers/extension.js":1,"./views/extension.js":3}],3:[function(a,b,c){var d,e=wp.wordpoints.hooks.view.Base,f=wp.wordpoints.hooks.Fields,g=wp.wordpoints.hooks.Args,h=Backbone.$;d=e.extend({namespace:"dynamic-points",className:"wordpoints-dynamic-points",template:wp.wordpoints.hooks.template("dynamic-points-hook-settings"),events:function(){var a={"click .enable":"enable","click .disable":"disable",'change [name="dynamic_points[arg]"]':"maybeShowRoundingForArg"};return"oninput"in document.createElement("input")?a['input [name="dynamic_points[multiply_by]"]']="maybeShowRoundingForMultiplyBy":a['keyup [name="dynamic_points[multiply_by]"]']="maybeShowRoundingForMultiplyBy",a},hierarchies:[],$settings:null,$regularPointsInput:null,$regularPoints:null,initialize:function(a){this.hierarchies=a.hierarchies,this.$regularPointsInput=this.reaction.$settings.find("[name=points]"),this.$regularPoints=this.$regularPointsInput.closest("p.description"),this.on("render",this.maybeShowRounding),this.listenTo(this.model,"invalid",this.showValidationErrors)},render:function(){var a=[];_.each(this.hierarchies,function(b){a.push({label:g.buildHierarchyHumanId(b),value:_.pluck(_.pluck(b,"attributes"),"slug").join(",")})});var b=this.reaction.model.get(["dynamic_points","arg"]);_.isArray(b)&&(b=b.join(","));var c=f.create("dynamic_points[arg]",b,{type:"select",options:a,label:this.model.data.arg_label}),d=f.create("dynamic_points[multiply_by]",this.reaction.model.get(["dynamic_points","multiply_by"]),{type:"number","default":1,label:this.model.data.multiply_by_label});return this.$el.html(this.template()),this.$settings=this.$(".wordpoints-dynamic-points-settings"),this.$settings.html(c+d),b&&0===this.reaction.model.get("points")&&(this.$settings.show(),this.$(".enable").hide(),this.$(".disable").show(),this.$regularPoints.hide()),this.trigger("render"),this},enable:function(a){a.preventDefault(),this.$settings.show(),this.$(".enable").hide(),this.$(".disable").show().focus(),this.$regularPoints.hide(),this.$regularPointsInput.val(0),this.reaction.lockOpen()},disable:function(a){a.preventDefault(),this.$settings.hide(),this.$(".disable").hide(),this.$(".enable").show(),this.$regularPoints.show(),this.$regularPointsInput.focus(),this.reaction.lockOpen()},showRounding:function(){var a=this.$(".wordpoints-dynamic-points-rounding-method");if(!a.length){var b=f.create("dynamic_points[rounding_method]",this.model.get(["dynamic_points","rounding_method"]),{type:"select",options:this.model.data.rounding_methods,label:this.model.data.rounding_method_label});a=h('<div class="wordpoints-dynamic-points-rounding-method"></div>').html(b),this.$settings.append(a)}a.show()},hideRounding:function(){this.$(".wordpoints-dynamic-points-rounding-method").hide()},shouldShowRounding:function(){return this.shouldShowRoundingForMultiplyBy()||this.shouldShowRoundingForArg()},maybeShowRounding:function(){this.shouldShowRounding()?this.showRounding():this.hideRounding()},shouldShowRoundingForArg:function(){var a=this.$('[name="dynamic_points[arg]"]'),b=g.getArgsFromHierarchy(a.val().split(","),this.model.get("event")),c=b[b.length-1];return"decimal_number"===c.get("data_type")},maybeShowRoundingForArg:function(){this.shouldShowRoundingForArg()?this.showRounding():this.shouldShowRoundingForMultiplyBy()||this.hideRounding()},shouldShowRoundingForMultiplyBy:function(){var a=this.$('[name="dynamic_points[multiply_by]"]');return-1!==a.val().indexOf(".")},maybeShowRoundingForMultiplyBy:function(){this.shouldShowRoundingForMultiplyBy()?this.showRounding():this.shouldShowRoundingForArg()||this.hideRounding()}}),b.exports=d},{}]},{},[2]);